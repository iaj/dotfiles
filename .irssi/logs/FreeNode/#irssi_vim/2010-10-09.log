--- Log opened Sat Oct 09 11:57:30 2010
--- Log closed Sat Oct 09 12:02:31 2010
--- Log opened Sat Oct 09 16:51:23 2010
16:51 --- Users 7 nicks [2 ops, 0 halfops, 0 voices, 5 normal]
16:52 --- Channel #irssi_vim was synced in 84 seconds
16:53 @shabble: argh, emergency keyboard repair
16:54 @rudi_s: ?
16:54 @shabble: my spacebar is having serious issues
16:55 @rudi_s: Ouch, I hope you can fix it.
--- Log closed Sat Oct 09 19:08:40 2010
--- Log opened Sat Oct 09 19:09:04 2010
19:09 --- Users 6 nicks [2 ops, 0 halfops, 0 voices, 4 normal]
19:09  estragib: favorite pastebin?
19:09 @shabble: pastie.org?
19:09 @shabble: I've been trying to repro on xterm/osx and it's not happening here
19:10 --- Channel #irssi_vim was synced in 76 seconds
19:12  estragib: http://pastie.org/1209839
19:14 @shabble: that is pretty weird.
19:14 @shabble: I can only imagine that something is triggering an irssi internal bug that's otherwise unlikely
19:15 @shabble: when you say 'make much smaller fast', how small and fast are you thinking?
19:15 @shabble: a screencast could be useful
19:15  estragib: your average mouse flick
19:15  estragib: i'll try with metacity, maybe it's wmii weirdness
19:16 @shabble: ok
19:18 @shabble: rudi_s: you about?
--- Log closed Sat Oct 09 19:50:56 2010
--- Log opened Sat Oct 09 19:51:19 2010
19:51 --- Users 6 nicks [2 ops, 0 halfops, 0 voices, 4 normal]
19:52 --- Channel #irssi_vim was synced in 74 seconds
20:26  estragib: shabble: that does indeed fix it
20:28 @shabble: ok, that's good to know
20:29 @shabble: still shouldn't happen though
20:29 @shabble: I wonder if it can be reproduced by something else that spams a lot
20:29  estragib: no, makes me feel a littlo squirmy about irssi actually :/
20:29 @shabble: yeah, good from my perspective
20:29 @shabble: less so from irssis :)
20:29  estragib: right :)
20:30 @shabble: do you know your way around gdb?
20:31  estragib: not really, only took baby steps
20:31 @rudi_s: shabble: pong
20:31  estragib: not that i haven't debugged anything, but those were windows days :/
20:31 @shabble: rudi_s: hey
20:32 @shabble: if you've got a minute, could you try reproducing the fast-resize crash bug with uberprompt?
20:32 @rudi_s: shabble: Sure. What should I do?
20:33 @shabble: hang on, I'll rehost estragib's screencast
20:33 @shabble: estragib: if that's ok? Nothing sensitive there is there?
20:34  estragib: no problem at all
20:35 @shabble: rudi_s: http://metavore.org/faff/irssi.ogv
20:35 @shabble: basically, have a big xterm, load the script, then resize it quickly
20:35 @shabble: and it should crash
20:35 @shabble: but doesn't if you disable debug
20:35 @rudi_s: shabble: xterm or is rxvt okay too?
20:36 @shabble: I'm not sure it will matter
20:36 @rudi_s: Ok, will try both.
20:36  estragib: mine is gnome-terminal actually
20:37 @rudi_s: estragib: Which irssi version is that?
20:38  estragib: irssi 0.8.14 (20090728 1938)
20:38 @rudi_s: shabble: I get that as well, with 0.8.12
20:38 @rudi_s: xmonad here
20:38 @rudi_s: And urxvt.
20:39 @rudi_s: And 0.8.15
20:40 @rudi_s: I got a backtrace in gdb .. not sure if this will help.
20:41 @shabble: there's already a backtrace at http://pastie.org/1209839
20:41 @shabble: does it look similar?
20:42 @rudi_s: shabble: I'm not sure, I only have one inside gdb.
20:42 @rudi_s: But it crashes in libc as well.
20:42 @shabble: invalid free?
20:42 @rudi_s: Could be, I'm no C expert. I'll paste mine
20:43 @shabble: I need to get a newer linux VM image, and my net is being massively crap right now
20:43 @rudi_s: http://paste.debian.net/94983/
20:43 @shabble: but I'll try to see if I can reproduce it later
20:43 @rudi_s: Yeah, looks like a free problem. term-terminfo.c:200 -> g_free(term_lines_empty);
20:44 @shabble: could build an irssi with -g debug symbols
20:44 @rudi_s: shabble: How?
20:45 @shabble: I think CFLAGS=-g make should do it
20:45 @shabble: I can't see a specific debug target/option in the makefile
20:47 @rudi_s: shabble: Ok, building with -g right now.
--- Log closed Sat Oct 09 20:53:30 2010
--- Log opened Sat Oct 09 20:53:51 2010
20:53 --- Users 7 nicks [2 ops, 0 halfops, 0 voices, 5 normal]
20:53 @shabble: are you definitely running hte right binary?
20:54 @rudi_s: shabble: Yes. What did you expect?
20:54 @shabble: oh, sorry, I was looking at the libc entries
20:54 @shabble: which obviously aren't going to have debug syms
20:54 --- Channel #irssi_vim was synced in 75 seconds
20:58 @rudi_s: shabble: Ok, definitely the free, if I remove it no crash .. but that's not really a solution.
20:58 @rudi_s: Anything else I can do to help with this?
21:01 @shabble: I'm wondering if it's a failure to handle sigwinch properly
21:02 @shabble: could you start a new irssi, then run something like 'perl -MTime::HiRes -e'while(1) { sleep(0.01); system("kill -n 28 <irssi pid>"); }' in another term
21:03 @rudi_s: shabble: Sure.
21:05 @rudi_s: shabble: Nothing happened.
21:05 @shabble: drop the sleep down to .001?
21:06 @rudi_s: shabble: SIGWINCH, right?
21:06 @shabble: yeah
21:06 @shabble: have I got the kill args right?
21:06 @shabble: I think my default is some wonky osx version
21:07 @rudi_s: shabble: I'm not sure, the man page suggested kill -WINCH which is what I'm used to.
21:07 @rudi_s: But it makes no difference, nothing happens.
21:07 @shabble: ok, try that
21:07 @shabble: with uberprompt loaded?
21:07 @shabble: hmm
21:07 @rudi_s: Yep.
21:07 @shabble: maybe it needs to actually change the term size to trigger it
21:07 @shabble: I can't think of a good way to automate that
21:07 @rudi_s: But it's the right pid.
21:07 @rudi_s: Me neither.
21:08 @shabble: hmm
21:08 @shabble: could create a screen region for it?
21:08 @shabble: and loop over screen -X resize foo?
21:10 @rudi_s: shabble: Hm, I just noticed something interesting, it only crashes if I change the height, changing the width doesn't matter.
21:11 @shabble: ok, interesting
21:12 @shabble: just playing with:  perl -MTime::HiRes -e'for(1..100) { print "Sizing\n"; qx|/usr/bin/screen -X resize -1|; sleep(0.0001);}'
21:12 @shabble: doesn't crash it for me
21:12 @shabble: but might for you?
21:12 @shabble: (assuming irssi in a screen as the active region, with at least 1 other region)
21:14 @rudi_s: shabble: Yeah, kills it.
21:14 @shabble: try dropping the delay?
21:14 @shabble: se if you can find the threshold that doesn't kill it?
21:14 @rudi_s: Ok, will do.
21:16 @rudi_s: It doesn't crash always ..
21:17 @shabble: even at the same speed?
21:17 @rudi_s: Even 0.1 kills it.
21:17 @shabble: sounds like a race condition somewhere
21:17 @shabble: unix signals are particularly bad for that
21:17 @rudi_s: Wait, it seems the sleep isn't working.
21:17 @shabble: oh
21:17 @shabble: do you have time::hires?
21:18 @shabble: crap, you need -MTime::HiRes=sleep I think
21:18 @rudi_s: I think so, yes.
21:18 @shabble: to export it properly
21:18 @rudi_s: Yep, that's it.
21:19 @rudi_s: 0.001 kills it, 0.005 seems to be enough not to kill it.
21:21 @rudi_s: 0.003 kills it only a few times, most of the time it works.
21:21 @rudi_s: shabble: ^
21:22 @shabble: ok
21:23 @rudi_s: But even 0.001 doesn't kill it all the time ..
21:25 @shabble: hrmmm
21:25 @shabble: does it crash without the script loaded?
21:25 @shabble: we need to make a test case as simple as possible
21:26 @shabble: given that it stops when debug is disabled, I'm going to guess it's print volume that's causing it
21:27 @rudi_s: shabble: Without the script it runs fine.
21:27 @shabble: so something like /script exec -permanent my $x = 0; my $t = Irssi::timeout_add(10, sub { print "Moo"; if ($x++ > 10000) Irssi::timeout_remove($t)}) might do it
21:30 @rudi_s: shabble: Nope, doesn't crash it.
21:30 @rudi_s: The moment I load uberprompt and run the screen thing, it crashes.
21:31 @shabble: hmm
21:31 @shabble: maybe longer lines?
21:31 @shabble: print "x" x 200 or something
21:32 @shabble: otherwise it's going to have to be related to the statusbars, and that stuff gets messy fast
21:32 @shabble: I dont' understand why disbaling debug fixes it though
21:32 @shabble: can you confirm that?
21:35 @rudi_s: shabble: No, "x" x 200 also runs fine.
--- Log closed Sat Oct 09 21:42:49 2010
--- Log opened Sat Oct 09 21:48:14 2010
21:48 --- Users 7 nicks [2 ops, 0 halfops, 0 voices, 5 normal]
21:49 --- Channel #irssi_vim was synced in 77 seconds
21:54 @rudi_s: shabble: Ok, I have a minimal example.
--- Log closed Sat Oct 09 22:03:41 2010
--- Log opened Sat Oct 09 22:04:02 2010
22:04 --- Users 7 nicks [2 ops, 0 halfops, 0 voices, 5 normal]
22:04 @rudi_s: I'm on Debian Lenny, crashes in irssi 0.8.12 and current SVN/Git.
22:04 @rudi_s: amd64 if that matters.
22:04 @shabble: I'll have another shot at reproducing it here first
22:04 @rudi_s: estragib: Could you try the sample.
22:04 @rudi_s: http://paste.debian.net/95010/
22:04 @rudi_s: And see if it crashes as well, thanks.
22:05 --- Channel #irssi_vim was synced in 76 seconds
22:10  estragib: yup, it does
22:10 @rudi_s: Ok, good.
22:10 @rudi_s: shabble: ^
22:10 @rudi_s: *"good"
22:15 @shabble: estragib: what os/version are you running?
22:15 * estragib blushes
22:15  estragib: i'd, uh, rather not say
22:16 @shabble: ah, makes it tricky to include int eh bug report
22:16  estragib: it's ubuntu lucid
22:16 @shabble: and irssi /version?
22:17  estragib: irssi 0.8.14 (20090728 1938)
22:17 @shabble: thanks
22:21 @shabble: http://bugs.irssi.org/index.php?do=details&task_id=772
--- Log closed Sat Oct 09 22:33:42 2010
--- Log opened Sat Oct 09 22:34:06 2010
22:34 --- Users 7 nicks [2 ops, 0 halfops, 0 voices, 5 normal]
22:35 --- Channel #irssi_vim was synced in 80 seconds
22:47 @rudi_s: shabble: Thanks, I hope that gets fixed. For now a note in the script should be enough (as most won't use it with DEBUG 1).
22:54 @shabble: yeah
23:00 @shabble: done
23:00  virssi-bot: irssi-scripts: master Tom Feist * 4973893 (1 files in 1 dirs): added Bugs section in comments describing crash bug when debug enabled. Rare ... - http://bit.ly/djkztg
23:01 @rudi_s: shabble: Can I now use uberprompt.pl as complete replacement for prompt_info.pl?
23:02  virssi-bot: irssi-scripts: master Tom Feist * 6012b57 (1 files in 1 dirs): added doc about uberprompt_format setting - http://bit.ly/aqjz66
23:03 @shabble: yeah, I think so
23:03 @rudi_s: shabble: Great, will try it.
23:03 @shabble: I need to make a few more changes to the 'prompt changed' response signal, but that shouldn't affect anything atm, because nothing uses it
23:04 @rudi_s: Ok, good.
23:04 @shabble: actually, let me quickly make it use a setting for enabling debug spam
23:04 @rudi_s: shabble: Btw. could you please merge dev.
23:04 @shabble: sure, 2 min
23:04 @rudi_s: Thanks, take your time.
23:05 @shabble: anything new & exciting?
23:05 @rudi_s: shabble: :mkv[imrc] and :unm[ap]
23:06 @rudi_s: Oh, and :map xxx <nop>
23:06 @shabble: cool
23:06 @shabble: oh, I was wondering how hard it would be to add tab-completion to :ex commands
23:06 @rudi_s: And invalid operator/commands are now ignored, like ck or yG.
23:07 @rudi_s: shabble: I'm not sure, will require some additional track keeping of completion status, etc. Should be doable, but IMHO not that important (we have only 15 or so ex-commands anyway).
23:08 @shabble: ok
23:08 @shabble: I'll throw it on the todo list and leave it for later :)
23:08 @rudi_s: shabble: But if you want to, please go ahead and add it ;-)
23:08 @rudi_s: Hehe, ok :-)
23:08 @rudi_s: Ah, already in the TODO list.
23:09 @rudi_s: shabble: Hm, uberprompt.pl moves my second statusbar line to the bottom again :-/
23:10 @rudi_s: And I have [(status)] (status)
23:10  virssi-bot: irssi-scripts: master Tom Feist * d2e68af (1 files in 1 dirs): added uberprompt_debug as an irssi setting. defaults to off. - http://bit.ly/cWqTH0
23:11 @shabble: not sure about the movement thing
23:11 @shabble: let me investigate the other quickly though
23:21  virssi-bot: irssi-scripts: master Tom Feist * 9dc60fc (2 files in 1 dirs): Merge remote branch 'origin/dev' - http://bit.ly/bGBqGq
23:21 @shabble: ok, merged
23:22 @rudi_s: shabble: Thanks.
23:22 @shabble: fixing uberprompt iwll take abit longer though
23:22 @shabble: doublly so because I'm covered in kittens :P
23:22 @rudi_s: ;-) Ok, will use prompt_info for the moment.
23:22 @shabble: I think I'm going to need to break the prompt_info api at some point
23:23 @shabble: but it should be a fairly small fix to evetyhing that uses it
23:23 @rudi_s: Shouldn't be a problem IMO.
--- Log closed Sat Oct 09 23:33:17 2010
--- Log opened Sat Oct 09 23:33:37 2010
23:33 --- Users 7 nicks [2 ops, 0 halfops, 0 voices, 5 normal]
23:33 --- Server: [hubbard.freenode.net] [freenode-info] if you're at a conference and other people are having trouble connecting, please mention it to staff: http://freenode.net/faq.shtml#gettinghelp
23:34 @rudi_s: shabble: Sorry, that must be left from previous tests. Thanks, works great now.
23:34 @shabble: np
23:34 @rudi_s: One problem though, is it expected that : is now displayed after the [...]?
23:34 --- Channel #irssi_vim was synced in 68 seconds
23:34 @shabble: yeah, that's the thing I'm hoping to solve
23:34 @rudi_s: Ok, good ;-)
23:35 @rudi_s: shabble: The switching my status line problem has somehow fixed itself.
23:35  estragib: that reminds me, will i be able to make the ex prompt replace my normal prompt at some point?
23:35 @rudi_s: (After cleaning my config of old statusbar/prompt settings.)
23:35 @shabble: yeah, there's a few quirks
23:35 @shabble: like it starting on the right under some circumstances
23:36  estragib: i asked that already, didn't i
23:38 @rudi_s: shabble: What do you think? Should we add an option to use the complete input line for ex-mode?
23:40 @shabble: not quite sure I follow?
23:41 @rudi_s: shabble: I thought that's what estragib is asking, to use the complete input line as ex-mode buffer.
23:41 @rudi_s: estragib: Right?
23:42 @shabble: do you mean having ':foo...' instead of '[prompt] :foo...'?
23:42  estragib: yeah, something like that. i meant have the : leftmost in place of the prompt. if the input line is completely invis then, even better
23:43 @shabble: hmm, the latter would have to wait for overlays, but the former will be possible quite soon
23:43 @shabble: not sure if it should be default or optional
23:43  estragib: on second thought, i don't know about the input line anyway. might be handy to see what's there for s///
23:44  estragib: which, btw, is totally great.
23:53 @shabble: :D
23:53 @shabble: was about the 2nd feature I implemented
23:53 @shabble: I'd quite like to add /c on there as well, but it'd be a bit of effort
23:59  estragib: pretty soon you'll have people ask whether they can use your script with emacs bindings
23:59 @shabble: haha
23:59 @shabble: just write an elisp interpreter in perl and let them loose :P
--- Log closed Sun Oct 10 00:00:39 2010
